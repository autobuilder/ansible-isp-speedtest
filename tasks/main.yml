---

- name: "Print ansible_distribution"
  debug:
    msg: "Running os family: {{ ansible_os_family }}"

- name: "Print ansible_distribution"
  vars:
    msg: |
      Running on distribution: {{ ansible_distribution }}
      set_java_home: {{ set_java_home }}
      java_version: {{ java_version }}
      java_subversion: {{ java_subversion }}
      java_buildnumber: {{ java_buildnumber }}
      download_path: {{ download_path }}
      download_java_from_oracle: {{ download_java_from_oracle }}
      remove_download: {{ remove_download }}
      java_home: {{ java_home }}
      jdk_version: {{ jdk_version }}
      jdk_arch: {{ jdk_arch }}
      jdk_os: {{ jdk_os }}
      jdk_version_detail: {{ jdk_version_detail }}
      jdk_tarball_file: {{ jdk_tarball_file }}
      jdk_tarball_url: {{ ansible_distribution }}
  debug:
    msg: "{{ msg.split('\n') }}"

- name: "Install software-properties-common"
  apt:
    name: "software-properties-common"
    install_recommends: yes
  when: ansible_os_family == 'Debian'

- name: "Add Oracle Java repository to apt sources"
  apt_repository:
    repo: "{{ java_apt_repository }}"
    state: present
  when: ansible_os_family == 'Debian'

- name: Accept Java 8 License
  debconf:
    name: oracle-java8-installer
    question: shared/accepted-oracle-license-v1-1
    value: 'true'
    vtype: select

- name: "Install Oracle Java using apt"
  apt:
    name: "{{ pkg }}"
    install_recommends: yes
  with_items:
    - "{{ java_package_name }}"
    - "{{ java_setdefault_package_name }}"
    - "ca-certificates"
  loop_control:
    loop_var: pkg
  when: ansible_os_family == 'Debian'

- name: "Add Oracle repository to yum sources"
  yum_repository:
    baseurl: "{{ java_yum_repository }}"
    state: present
  when: ansible_os_family == 'RedHat'

- name: "Install Oracle using yum"
  yum:
    name: "{{ java_package_name }}"
  when: ansible_os_family == 'RedHat'
